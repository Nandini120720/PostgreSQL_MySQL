###### Plan of actions

1) taking backup of user and their privileges for safer side.
mysqldump -u root -p mysql user > mysql_user_privileges.sql or
mysqldump -u root -p mysql user db tables_priv columns_priv procs_priv proxies_priv > mysql_all_privileges.sql


2)create file 
/usr/local/bin/create_mysql_user.sh

3)script
 
#!/bin/bash

# Prompt for new MySQL user and password
read -p "Enter MySQL username to create: " new_user
read -s -p "Enter password for $new_user: " user_pass
echo

# Function to validate password against policy
validate_password() {
    local pass=$1

    if [[ ${#pass} -lt 8 ]]; then
        echo "Password must be at least 8 characters."
        return 1
    elif ! [[ $pass =~ [A-Z] ]]; then
        echo "Password must include at least one uppercase letter."
        return 1
    elif ! [[ $pass =~ [a-z] ]]; then
        echo "Password must include at least one lowercase letter."
        return 1
    elif ! [[ $pass =~ [0-9] ]]; then
        echo "Password must include at least one number."
        return 1
    elif ! [[ $pass =~ [\!\@\#\$\%\^\&\*\(\)\_\+\.\,\-\=\[\]\{\}] ]]; then
        echo "Password must include at least one special character."
        return 1
    else
        return 0
    fi
}


# If password is valid, continue
if validate_password "$user_pass"; then
    echo "Password is valid. Creating user..."

# Prompt for database name or * for all
    read -p "Enter database name to grant access (or * for ALL databases): " db_name

# Prompt for host information (localhost, IP, or %)
    read -p "Enter host (localhost, IP address, or % for all): " host

# Prompt for MySQL root password
    read -s -p "Enter MySQL root password: " root_pass
    echo

# Check if user already exists
    user_exists=$(mysql -u root -p"$root_pass" -sse "SELECT EXISTS(SELECT 1 FROM mysql.user WHERE user = '$new_user' AND host = '$host');")

if [ "$user_exists" -eq 1 ]; then
        echo "User '$new_user' already exists for host '$host'. No action taken."
        exit 1
    else


   # Create new user and grant privileges
    mysql -u root -p"$root_pass" -e "CREATE USER '$new_user'@'$host' IDENTIFIED BY '$user_pass';"
    mysql -u root -p"$root_pass" -e "GRANT ALL PRIVILEGES ON ${db_name}.* TO '$new_user'@'$host';"
    echo "User $new_user created and granted access to '${db_name}' from '$host'."
  fi

else
    echo "Password does not meet policy. User was not created."
    exit 1
fi



4)give ownerships
sudo chmod 700 /usr/local/bin/create_mysql_user.sh
sudo chown root:root /usr/local/bin/create_mysql_user.sh

5)run the script
./create_mysql_user.sh



